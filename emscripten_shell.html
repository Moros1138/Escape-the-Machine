<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Escape The Machine</title>
    <link href="https://fonts.cdnfonts.com/css/press-start" rel="stylesheet">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Press Start', sans-serif;
            background: #00001e;
            color: #ded;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-items: center;
            justify-content: center;
        }

        .light {
            background: #fff;
            color: #000;
        }

        #container {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            text-align: center;
        }

        #canvas {
            display: none;
            border: 0px none;
            background-color: black;
            margin: 0 auto;
        }


        #canvas:focus {
            outline: none;
        }

        #start-screen {
            display: none;
        }
        
        body.start #start-screen img {
            display: block;
            width: 100%;
            height: auto;
        }

        #loading-screen {
            display: none;
        }

        body.start #start-screen {
            max-width: 30rem;
            width: 100%;
            display: block;
        }
        
        body.start #pge-logo-container {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 1rem;
            width: 100%;
            text-align: center;
        }
        
        body.start #pge-logo-container img {
            display: inline;
            max-width: 15rem;
            width: 100%;
        }

        #start-screen .activate {
            font-family: 'Press Start', sans-serif;
            font-size: 1.2rem;
            padding: 1.2rem;
            margin: 2rem 0 1rem 0;
            color: #ded;
            text-shadow: .1rem .1rem .1rem #000;
            cursor: pointer;
        }

        #loading-screen > div {
            max-width: 30rem;
            width: 100%;
        }

        #loading-screen > div img {
            width: 100%;
            height: auto;
        }
        
        #loading-screen > div span {
            text-shadow: .2rem .1rem .4rem #000;
            font-size: 2rem;
        }

        body.loaded #canvas {
            display: block;
        }
    </style>
</head>

<body>
    <div id="container">
        <canvas id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
        <div id="start-screen">
            <p>
                <img id="hamster-planet" src="web-assets/escape-the-machine.png">
            </p>
            <p class="activate">
                Click to Activate Game
            </p>
            
            <div id="pge-logo-container">
                <img id="pge-logo" src="web-assets/pge2_logo.png" alt="Powered by: olc::PixelGameEngine">
            </div>
        </div>
        <div id="loading-screen">
            <div>
                <span>Loading...</span>
            </div>
        </div>
    </div>
    <script type='text/javascript'>

var Module = {
    print: (function () {
        return (...args) => {
            console.log(args.join(' '));
        };
    })(),
    canvas: (() => {
        var canvas = document.getElementById('canvas');

        // As a default initial behavior, pop up an alert when webgl context is lost. To make your
        // application robust, you may want to override this behavior before shipping!
        // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
        canvas.addEventListener("webglcontextlost", (e) => { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);

        return canvas;
    })(),
    setStatus: (text) => {},
    totalDependencies: 0,
    monitorRunDependencies: (left) => {},
    
    preRun: [
        function()
        {
            document.body.classList.toggle("start", true);
            Module["addRunDependency"]("click-to-start");
            
            startHandler = (event) =>
            {
                event.preventDefault();
                document.body.classList.toggle("loading", true);
                document.body.classList.toggle("start", false);
                
                document.getElementById('canvas').focus();
                document.body.removeEventListener("click", startHandler);
                setTimeout(() => Module["removeRunDependency"]("click-to-start"), 50);
            };
            
            document.body.addEventListener("click", startHandler);
        },
    ],
    
    onRuntimeInitialized: function()
    {
        document.body.classList.toggle("loading", false);
        document.body.classList.toggle("loaded", true);
    },
};
    </script> 
    {{{ SCRIPT }}}

    <script>
        function ScreenWidth()
        {
            return Math.floor(window.innerWidth);
        }
        
        function ScreenHeight()
        {
            return Math.floor(window.innerHeight);
        }
        
        function Rand()
        {
            return Math.floor(Math.random() * 1000000);
        }
        
        function TimeStamp()
        {
            return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
        }
        
        var now, dt, last = TimeStamp();
        
        var StarMap = {
            
            mColors: [],
            mStars: [],
            interval: null,
            create: function()
            {
                for(var i = 0; i < 400; i++)
                {
                    this.mStars.push({
                        x: Rand() % ScreenWidth(),
                        y: Rand() % ScreenHeight(),
                        id: '#star-' + i.toString()
                    });
        
                    this.mColors.push('#fff');
        
                    var elem = document.createElement('DIV');
                    elem.setAttribute('id', 'star-' + i.toString());
                    elem.style.display = "block";
                    elem.style.position = "fixed";
                    elem.style.width = ".2vw";
                    elem.style.height =".2vw";
                    elem.style.backgroundColor = "#fff";
                    elem.style.top = "-50px";
                    elem.style.left = "-50px";
                    elem.style.zIndex = "-1";
                    document.body.appendChild(elem);
        
                }
            }, // create
        
            update: function(deltaTime)
            {
                for(var i = 0; i < this.mStars.length; i++)
                {
                    var modifier = 1.0;
                    this.mColors[i] = '#fff';
                    
                    if(i <= this.mStars.length * 0.25)
                    {
                        modifier = 0.4;
                        this.mColors[i] = '#424242';
                    }
                    else if(i <= this.mStars.length * 0.5)
                    {
                        modifier = 0.6;
                        this.mColors[i] = '#808080';
                    }
                    else if(i <= this.mStars.length * 0.75)
                    {
                        modifier = 0.8;
                        this.mColors[i] = '#c6c6c6';
                    }
                    
                    this.mStars[i].y += (18 + deltaTime * modifier) * 0.1;
                    
                    if(this.mStars[i].y > ScreenHeight())
                    {
                        this.mStars[i].x = Rand() % ScreenWidth();
                        this.mStars[i].y = 0;
                    }
                } // for mStars.length
        
            }, // update
            
            draw: function()
            {
                for(var i = 0; i < this.mStars.length; i++)
                {
                    var elem = document.querySelector(this.mStars[i].id);
                    elem.style.left = this.mStars[i].x.toString() + 'px';
                    elem.style.top = this.mStars[i].y.toString() + 'px';
                    elem.style.backgroundColor = this.mColors[i];
                } // for mStars.length
            },
        
            frame: function()
            {
                now = TimeStamp();
                dt = (now - last) / 1000;
                last = now;
                
                StarMap.update(dt);
                StarMap.draw();
            },
            
            resize: function()
            {
                for(var i = 0; i < 400; i++)
                {
                    this.mStars[i].x = Rand() % ScreenWidth();
                    this.mStars[i].y = Rand() % ScreenHeight();
                }
                StarMap.draw();
            },
        
            start: function()
            {
                StarMap.frame();
                StarMap.interal = setInterval(() =>
                {
                    StarMap.frame();
                }, 32);
            },

            stop: function()
            {
                clearInterval(StarMap.interval);
            }
        };
        
        window.addEventListener('resize', function()
        {
            StarMap.resize();
        });
        
        StarMap.create();
        StarMap.start();
    </script>
</body>

</html>



